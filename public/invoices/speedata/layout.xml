<Layout version="5.1.24"
	xmlns="urn:speedata.de:2009/publisher/en"
	xmlns:sf="urn:speedata/layoutfunctions"
	xmlns:sd="urn:speedata:2009/publisher/functions/en"
	xmlns:rsm="urn:un:unece:uncefact:data:standard:CrossIndustryInvoice:100"
	xmlns:ram="urn:un:unece:uncefact:data:standard:ReusableAggregateBusinessInformationEntity:100"
	xmlns:udt="urn:un:unece:uncefact:data:standard:UnqualifiedDataType:100"
	xmlns:bc="urn:billingcat.de/ns/billingcatsettings"
>
	<DefineColor name="green" model="cmyk" c="70" m="8" y="98" k="25" />
	<AttachFile type="ZUGFeRD invoice" filename="data.xml" />
	<Options namespaces="strict" />

	<Pageformat height="297mm" width="210mm" />
	<SetGrid height="12pt" nx="10" />

	<Record element="bc:BillingcatSettings">
		<SetVariable variable="letterhead" select="bc:letterhead" />
		<SetVariable variable="region_invoice_info" select="$letterhead/bc:regions/bc:region[@kind = 'invoice_info']" />
		<SetVariable variable="region_main" select="$letterhead/bc:regions/bc:region[@kind = 'main_area']" />
		<SetVariable variable="region_main_area_page_2" select="$letterhead/bc:regions/bc:region[@kind = 'main_area_page_2']" />
		<SetVariable variable="region_addressee" select="$letterhead/bc:regions/bc:region[@kind = 'addressee']" />

        <Switch>
            <Case test="not(bc:introductionText = '')">
                <SetVariable variable="opening" select="bc:introductionText" />
            </Case>
        </Switch>
        <Switch>
            <Case test="not(bc:conclusionText = '')">
                <SetVariable variable="closing" select="bc:conclusionText" />
            </Case>
        </Switch>

		<SetVariable variable="page_wd" select="$letterhead/bc:pageWidthCm" />
		<SetVariable variable="page_ht" select="$letterhead/bc:pageHeightCm" />
		<Pageformat height="{$page_ht}cm" width="{$page_wd}cm" />

		<SetVariable variable="pdfPath" select="$letterhead/bc:pdfPath" />
		<SetVariable variable="pdfPath2" select="$letterhead/bc:pdfPath2" />
		<LoadFontfile name="regular" filename="texgyreheros-regular.otf" />
		<LoadFontfile name="bold" filename="texgyreheros-bold.otf" />
		<LoadFontfile name="italic" filename="texgyreheros-italic.otf" />



		<ProcessNode select="$letterhead/bc:fonts" />

		<DefineFontfamily fontsize="{$region_main/bc:fontSizePt}pt" leading="{$region_main/bc:fontSizePt * $region_main/bc:lineSpacing}pt" name="text">
			<Regular fontface="regular" />
			<Bold fontface="bold" />
			<Italic fontface="italic" />
		</DefineFontfamily>

		<DefineFontfamily fontsize="{$region_main/bc:fontSizePt}pt" leading="{$region_main/bc:fontSizePt * $region_main/bc:lineSpacing}pt" name="main">
			<Regular fontface="regular" />
			<Bold fontface="bold" />
			<Italic fontface="italic" />
		</DefineFontfamily>

		<DefineFontfamily fontsize="{$region_addressee/bc:fontSizePt}pt" leading="{$region_addressee/bc:fontSizePt * $region_addressee/bc:lineSpacing}pt" name="addressee">
			<Regular fontface="regular" />
			<Bold fontface="bold" />
			<Italic fontface="italic" />
		</DefineFontfamily>

		<DefineFontfamily fontsize="{$region_invoice_info/bc:fontSizePt}pt" leading="{$region_invoice_info/bc:fontSizePt * $region_invoice_info/bc:lineSpacing}pt" name="invoice_info">
			<Regular fontface="regular" />
			<Bold fontface="bold" />
			<Italic fontface="italic" />
		</DefineFontfamily>

		<Pagetype name="firstpage" test="true()">
			<Margin top="{$region_main/bc:yCm}cm" bottom="{$page_ht - $region_main/bc:yCm - $region_main/bc:heightCm}cm" left="{$region_main/bc:xCm}cm" right="{$page_wd - $region_main/bc:xCm - $region_main/bc:widthCm}cm" />
			<AtPageCreation>
				<PlaceObject column="0mm" row="0mm">
					<Image width="{$page_wd}cm" height="{$page_ht}cm" file="{$pdfPath}" />
				</PlaceObject>
			</AtPageCreation>
		</Pagetype>
		<Switch>
			<Case test="count($region_main_area_page_2/*) > 1 ">
				<Pagetype name="otherpages" test="sd:current-page() > 1">
					<Margin top="{$region_main_area_page_2/bc:yCm}cm" bottom="{$page_ht - $region_main_area_page_2/bc:yCm - $region_main_area_page_2/bc:heightCm}cm" left="{$region_main_area_page_2/bc:xCm}cm" right="{$page_wd - $region_main_area_page_2/bc:xCm - $region_main_area_page_2/bc:widthCm}cm" />
					<AtPageCreation>
						<PlaceObject column="0mm" row="0mm">
							<Image width="{$page_wd}cm" height="{$page_ht}cm" file="{$pdfPath2}" page="1"/>
						</PlaceObject>
					</AtPageCreation>
				</Pagetype>
			</Case>
		</Switch>
	</Record>
	<Record element="bc:fonts">
		<ForAll select="*">
			<Switch>
				<Case test="local-name() = 'normal'">
					<LoadFontfile name="regular" filename="{.}" />
				</Case>
				<Case test="local-name() = 'bold'">
					<LoadFontfile name="bold" filename="{.}" />
				</Case>
				<Case test="local-name() = 'italic'">
					<LoadFontfile name="italic" filename="{.}" />
				</Case>
			</Switch>
		</ForAll>
	</Record>


	<Function name="sf:format-iban">
		<Param name="iban" />
		<Value select="replace($iban,'(.{4})', '$1 ')" />
	</Function>
	<Function name="sf:format-date">
		<Param name="date" />
		<Value select="concat(format-number(substring($date, 7, 2), '0'), '.',format-number(substring($date, 5, 2), '0'), '.',substring($date, 1, 4))" />
	</Function>
	<Function name="sf:currency-code-to-text">
		<Param name="code" />
		<Switch>
			<Case test="$code = 'EUR'">
				<Value>€</Value>
			</Case>
			<Case test="$code = 'USD'">
				<Value>$</Value>
			</Case>
			<Otherwise>
				<Value select="$code" />
			</Otherwise>
		</Switch>
	</Function>
	<Function name="sf:tax-category-code-to-text">
		<Param name="code" />
		<Param name="rate" />
		<Param name="exemption" />
		<Switch>
			<Case test="$code = 'S'">
				<Value select="$rate" />
				<Value>%</Value>
				<Value>&#xa0;</Value>
				<Value>Umsatzsteuer</Value>
			</Case>
			<Case test="$code = 'AA'">
				<Value select="$rate" />
				<Value>%</Value>
				<Value>&#xa0;</Value>
				<Value>Ermäßigt A</Value>
			</Case>
			<Case test="$code = 'B'">
				<Value select="$rate" />
				<Value>%</Value>
				<Value>&#xa0;</Value>
				<Value>Ermäßigt B</Value>
			</Case>
			<Case test="$code = 'Z'">
				<Value>Nullsatz</Value>
			</Case>
			<Case test="$code = 'AE'">
				<Value select="$exemption" />
			</Case>
			<Case test="$code = 'E'">
				<Value select="$exemption" />
			</Case>
			<Case test="$code = 'K'">
				<Value select="$exemption" />
			</Case>
			<Otherwise>
				<Value select="$code" />
			</Otherwise>
		</Switch>
	</Function>
	<!-- see https://erechnung.berlin/cii/unitcode/ -->
	<Function name="sf:unitcode-to-text">
		<Param name="code" />
		<Switch>
			<Case test="$code = 'C62'">
				<Value>Stück</Value>
			</Case>
			<Case test="$code = 'KGM'">
				<Value>kg</Value>
			</Case>
			<Case test="$code = 'LTR'">
				<Value>Liter</Value>
			</Case>
			<Case test="$code = 'MON'">
				<Value>Monate</Value>
			</Case>
			<Case test="$code = 'HUR'">
				<Value>Stunden</Value>
			</Case>
			<Case test="$code = 'MTK'">
				<Value>m²</Value>
			</Case>
			<Case test="$code = 'H87'">
				<Value>Stück</Value>
			</Case>
			<Otherwise>
				<Value select="$code" />
			</Otherwise>
		</Switch>
	</Function>
	<Function name="sf:remove-decimal-zeros">
		<Param name="amount" />
		<Value select="format-number(number($amount), '0.##')" />
	</Function>
	<Function name="sf:format-amount">
		<Param name="amount" />
		<Value select="format-number($amount, '#,##0.00')" />
	</Function>


	<!-- Generic invoice layout -->
	<Record element="rsm:CrossIndustryInvoice">
		<SetVariable variable="SellerTradeParty" select="rsm:SupplyChainTradeTransaction/ram:ApplicableHeaderTradeAgreement/ram:SellerTradeParty" />
		<SetVariable variable="BuyerTradeParty" select="rsm:SupplyChainTradeTransaction/ram:ApplicableHeaderTradeAgreement/ram:BuyerTradeParty" />
		<SetVariable variable="ApplicableHeaderTradeSettlement" select="rsm:SupplyChainTradeTransaction/ram:ApplicableHeaderTradeSettlement" />
		<SetVariable variable="PaymentTerms" select="rsm:SupplyChainTradeTransaction/ram:ApplicableHeaderTradeSettlement/ram:SpecifiedTradePaymentTerms" />
		<SetVariable variable="currencyCode" select="sf:currency-code-to-text($ApplicableHeaderTradeSettlement/ram:InvoiceCurrencyCode)" />

		<Switch>
			<Case test="sd:file-exists('settings.xml')">
				<SetVariable variable="hasLetterhead" select="true()" />
				<ProcessNode select="doc('settings.xml')/bc:BillingcatSettings" />
			</Case>
			<Otherwise>
				<!-- generic page type, no PDF letterhead-->
				<SetVariable variable="hasLetterhead" select="false()" />
				<DefineFontfamily fontsize="10pt" leading="12pt" name="main">
					<Regular fontface="serif" />
					<Bold fontface="serif-bold" />
					<Italic fontface="serif-italic" />
					<BoldItalic fontface="serif-bolditalic" />
				</DefineFontfamily>
				<DefineFontfamily fontsize="10pt" leading="12pt" name="text">
					<Regular fontface="serif" />
					<Bold fontface="serif-bold" />
					<Italic fontface="serif-italic" />
					<BoldItalic fontface="serif-bolditalic" />
				</DefineFontfamily>
				<DefineFontfamily fontsize="8pt" leading="10pt" name="small">
					<Regular fontface="serif" />
					<Bold fontface="serif-bold" />
					<Italic fontface="serif-italic" />
					<BoldItalic fontface="serif-bolditalic" />
				</DefineFontfamily>
				<DefineFontfamily fontsize="10pt" leading="12pt" name="addressee">
					<Regular fontface="serif" />
					<Bold fontface="serif-bold" />
					<Italic fontface="serif-italic" />
					<BoldItalic fontface="serif-bolditalic" />
				</DefineFontfamily>
				<DefineFontfamily fontsize="10pt" leading="12pt" name="invoice_info">
					<Regular fontface="serif" />
					<Bold fontface="serif-bold" />
					<Italic fontface="serif-italic" />
					<BoldItalic fontface="serif-bolditalic" />
				</DefineFontfamily>

				<Pagetype name="all pages" test="true()">
					<Margin top="10mm" bottom="10mm" left="20mm" right="10mm" />
					<AtPageCreation>
						<Switch>
							<Case test="sd:file-exists('logo.pdf')">
								<PlaceObject row="20mm" column="200mm" hreference="right">
									<Image file="logo.pdf" width="40mm" />
								</PlaceObject>
							</Case>
						</Switch>
					</AtPageCreation>
					<AtPageShipout>
						<PlaceObject column="0mm" row="0mm">
							<Box height="297mm" width="5mm" background-color="green" />
						</PlaceObject>
						<SetVariable variable="iban" select="$ApplicableHeaderTradeSettlement/ram:SpecifiedTradeSettlementPaymentMeans/ram:PayeePartyCreditorFinancialAccount/ram:IBANID" />
						<PlaceObject row="280mm" column="20mm">
							<Table stretch="max">
								<Columns>
									<Loop select="3">
										<Column width="1*" />
									</Loop>
								</Columns>
								<Tr valign="top">
									<Td>
										<Paragraph>
											<Value select="$SellerTradeParty/ram:Name" />
											<Br />
											<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:LineOne" />
											<Br />
											<Switch>
												<Case test="not(string($SellerTradeParty/ram:PostalTradeAddress/ram:LineTwo) = '')">
													<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:LineTwo" />
													<Br />
												</Case>
											</Switch>
											<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:PostcodeCode" />
											<Value>&#xa0;</Value>
											<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:CityName" />
										</Paragraph>
									</Td>
									<Switch>
										<Case test="not(string($iban) = '')">
											<Td>
												<Paragraph>
													<Value>Bankverbindung</Value>
													<Br />
													<Value select="$ApplicableHeaderTradeSettlement/ram:SpecifiedTradeSettlementPaymentMeans/ram:PayeePartyCreditorFinancialAccount/ram:AccountName" />
													<Br />
													<Value select="sf:format-iban($ApplicableHeaderTradeSettlement/ram:SpecifiedTradeSettlementPaymentMeans/ram:PayeePartyCreditorFinancialAccount/ram:IBANID)" />
												</Paragraph>
											</Td>
										</Case>
									</Switch>
									<Td>
										<Paragraph>
											<Value>Umsatzsteuer-ID</Value>
											<Br />
											<Value select="$SellerTradeParty/ram:SpecifiedTaxRegistration/ram:ID[@schemeID = 'VA']" />
										</Paragraph>
									</Td>
								</Tr>
							</Table>
						</PlaceObject>
					</AtPageShipout>
				</Pagetype>
			</Otherwise>
		</Switch>

		<!-- addressee -->
		<ProcessNode select="$BuyerTradeParty" />
		<!-- invoice number and date -->
		<ProcessNode select="rsm:ExchangedDocument" />

		<!-- opening -->
		<SetVariable variable="row" select="if ($hasLetterhead) then sd:current-row() else  20" />
		<Switch>
			<Case test="sd:variable-exists('opening') and not(string($opening) = '')">
				<PlaceObject column="1" row="{$row}">
					<Textblock>
						<Paragraph>
							<Value select="sd:decode-html($opening)" />
						</Paragraph>
					</Textblock>
				</PlaceObject>
				<NextRow rows="2" />
			</Case>
			<Otherwise>
				<PlaceObject column="1" row="{$row}">
					<Box height="1" width="{sd:number-of-columns()}" background-color="-" />
				</PlaceObject>
			</Otherwise>
		</Switch>
		<SetVariable variable="hasDifferentTax" select="count(distinct-values(rsm:SupplyChainTradeTransaction/ram:IncludedSupplyChainTradeLineItem/ram:SpecifiedLineTradeSettlement/ram:ApplicableTradeTax/ram:RateApplicablePercent)) > 1" />

		<SetVariable variable="ncolumns" select="if ($hasDifferentTax) then 6 else 5" />
		<PlaceObject>
			<Table stretch="max" columndistance="5pt" padding="2pt" fontfamily="main">
				<Columns>
					<Column width="1.4cm" />
					<Column width="2cm" />
					<Column width="1*" />
					<Switch>
						<Case test="$hasDifferentTax">
							<Column width="1cm" />
						</Case>
					</Switch>
					<Column width="2.5cm" />
					<Column width="2.8cm" />
				</Columns>
				<Tablehead>
					<Tablerule />
					<Tr valign="top" align="center">
						<Td align="right">
							<Paragraph>
								<B>
									<Value>Menge</Value>
								</B>
							</Paragraph>
						</Td>
						<Td align="center">
							<Paragraph>
								<B>
									<Value>Einheit</Value>

								</B>
							</Paragraph>
						</Td>
						<Td>
							<Paragraph>
								<B>
									<Value>Leistung</Value>
								</B>
							</Paragraph>
						</Td>
						<Switch>
							<Case test="$hasDifferentTax">
								<Td align="right">
									<Paragraph>
										<B>
											<Value>Steuer</Value>
										</B>
									</Paragraph>
								</Td>
							</Case>
						</Switch>
						<Td align="right">
							<Paragraph>
								<B>
									<Value>Einzelpreis (</Value>
									<Value select="$currencyCode" />
									<Value>)</Value>
								</B>
							</Paragraph>
						</Td>
						<Td align="right" padding-right="4pt">
							<Paragraph>
								<B>
									<Value>Gesamtpreis (</Value>
									<Value select="$currencyCode" />
									<Value>)</Value>
								</B>
							</Paragraph>
						</Td>
					</Tr>
					<Tablerule />
				</Tablehead>
				<Tablefoot page="all">
					<Tablerule></Tablerule>
					<Tr>
						<Td colspan="{$ncolumns}" align="right">
							<Paragraph>
								<Value>...</Value>
							</Paragraph>
						</Td>
					</Tr>
				</Tablefoot>
				<Tablefoot page="last"/>
				<ForAll select="rsm:SupplyChainTradeTransaction/ram:IncludedSupplyChainTradeLineItem">
					<Tr valign="top" break-below="{if ( position() = last() ) then 'no' else 'yes'}">
						<Td align="right">
							<Paragraph>
								<Switch>
									<Case test="ram:SpecifiedLineTradeDelivery/ram:BilledQuantity/@unitCode = 'HUR'">
										<Value
											select="
  concat(
    format-number(
      floor(
        round(number(ram:SpecifiedLineTradeDelivery/ram:BilledQuantity) * 60)
        div 60
      ),
      '0'
    ),
    ':',
    format-number(
      round(number(ram:SpecifiedLineTradeDelivery/ram:BilledQuantity) * 60)
      - floor(
          round(number(ram:SpecifiedLineTradeDelivery/ram:BilledQuantity) * 60)
          div 60
        ) * 60,
      '00'
    )
  )
" />
									</Case>
									<Otherwise>
										<Value select="sf:remove-decimal-zeros(ram:SpecifiedLineTradeDelivery/ram:BilledQuantity)" />
									</Otherwise>
								</Switch>
							</Paragraph>
						</Td>
						<Td align="center">
							<Paragraph>
								<Value select="sf:unitcode-to-text(ram:SpecifiedLineTradeDelivery/ram:BilledQuantity/@unitCode)" />
							</Paragraph>
						</Td>
						<Td>
							<Paragraph>
								<Value select="ram:SpecifiedTradeProduct/ram:Name" />
								<Switch>
									<Case test="not(string(ram:SpecifiedTradeProduct/ram:Description) = '')">
										<Br />
										<Value select="ram:SpecifiedTradeProduct/ram:Description" />
									</Case>
								</Switch>
							</Paragraph>
						</Td>
						<Switch>
							<Case test="$hasDifferentTax">
								<Td align="right">
									<Paragraph>
										<Value select="sf:remove-decimal-zeros(ram:SpecifiedLineTradeSettlement/ram:ApplicableTradeTax/ram:RateApplicablePercent)" />
										<Value>%</Value>
									</Paragraph>
								</Td>
							</Case>
						</Switch>

						<Td align="right">
							<Paragraph>
								<Value select="sf:format-amount(ram:SpecifiedLineTradeAgreement/ram:NetPriceProductTradePrice/ram:ChargeAmount)" />
							</Paragraph>
						</Td>
						<Td align="right" padding-right="4pt">
							<Paragraph>
								<Value select="ram:SpecifiedLineTradeSettlement/ram:SpecifiedTradeSettlementLineMonetarySummation/ram:LineTotalAmount" />
							</Paragraph>
						</Td>
					</Tr>
				</ForAll>
				<Tablerule break-below="no" />
				<Tablerule rulewidth="3pt" color="-" break-below="no" />
				<Tr break-below="no">
					<Td colspan="{$ncolumns - 1 }" align="left">
						<Paragraph>
							<B>
								<Value>Nettosumme</Value>
							</B>
						</Paragraph>
					</Td>
					<Td align="right">
						<Paragraph>
							<B>
								<Value select="$ApplicableHeaderTradeSettlement/ram:SpecifiedTradeSettlementHeaderMonetarySummation/ram:LineTotalAmount" />
							</B>
						</Paragraph>
					</Td>
				</Tr>
				<ForAll select="$ApplicableHeaderTradeSettlement/ram:ApplicableTradeTax">
					<Tr valign="top" break-below="no">
						<Td colspan="{$ncolumns - 1 }" align="left">
							<Paragraph>
								<Value select="sf:tax-category-code-to-text(ram:CategoryCode, sf:remove-decimal-zeros(ram:RateApplicablePercent), ram:ExemptionReason)" />
								<Switch>
									<Case test="ram:CategoryCode = 'K'">
										<Br />
										<Value>USt-ID des Emfängers: </Value>
										<Value select="$BuyerTradeParty/ram:SpecifiedTaxRegistration/ram:ID[@schemeID = 'VA']" />
									</Case>
								</Switch>
							</Paragraph>
						</Td>
						<Td align="right">
							<Paragraph>
								<Value select="ram:CalculatedAmount" />
							</Paragraph>
						</Td>
					</Tr>
				</ForAll>
				<Tablerule break-below="no" />
				<Tablerule rulewidth="3pt" color="-"  break-below="no"/>
				<Tr break-below="no">
					<Td colspan="{$ncolumns - 1 }" align="left">
						<Paragraph>
							<B>
								<Value>Gesamtbetrag</Value>
							</B>
						</Paragraph>
					</Td>
					<Td align="right">
						<Paragraph>
							<B>
								<Value select="$ApplicableHeaderTradeSettlement/ram:SpecifiedTradeSettlementHeaderMonetarySummation/ram:GrandTotalAmount" />
							</B>
						</Paragraph>
					</Td>
				</Tr>
				<Switch>
					<Case test="not($ApplicableHeaderTradeSettlement/ram:BillingSpecifiedPeriod/ram:StartDateTime/udt:DateTimeString = '')">
						<Tr break-below="no">
							<Td padding-top="10pt" colspan="{$ncolumns}">
								<Paragraph>
									<Value>Leistungszeitraum: </Value>
									<Value select="sf:format-date($ApplicableHeaderTradeSettlement/ram:BillingSpecifiedPeriod/ram:StartDateTime/udt:DateTimeString)" />
									<Value> bis </Value>
									<Value select="sf:format-date($ApplicableHeaderTradeSettlement/ram:BillingSpecifiedPeriod/ram:EndDateTime/udt:DateTimeString)" />
								</Paragraph>
							</Td>
						</Tr>
					</Case>
				</Switch>
				<Switch>
					<Case test="sd:variable-exists('closing')">
						<Tr break-below="no">
							<Td colspan="{$ncolumns}" padding-top="24pt">
								<Paragraph>
									<Value select="sd:decode-html($closing)" />
								</Paragraph>
							</Td>
						</Tr>
					</Case>
				</Switch>
				<Switch>
					<Case test="sd:variable-exists('noteAAK')">
						<Tr>
							<Td colspan="{$ncolumns}">
								<Paragraph>
									<Value select="$noteAAK" />
								</Paragraph>
							</Td>
						</Tr>
					</Case>
				</Switch>
				<Switch>
					<Case test="not(string($PaymentTerms/ram:Description) = '')">
						<Tr>
							<Td colspan="{$ncolumns}">
								<Paragraph>
									<Value select="$PaymentTerms/ram:Description" />
								</Paragraph>
							</Td>
						</Tr>
					</Case>
				</Switch>

			</Table>
		</PlaceObject>
	</Record>

	<Record element="rsm:ExchangedDocument">
		<ForAll select="ram:IncludedNote">
			<Switch>
				<Case test="not(string(ram:SubjectCode) = '')">
					<SetVariable variable="{concat('note', ram:SubjectCode)}" select="ram:Content" />
				</Case>
				<Case test="contains(ram:Content, '·')">
					<ForAll select="tokenize(ram:Content,'·')">
						<Switch>
							<Case test="position() = 1">
								<SetVariable variable="opening" select="." />
							</Case>
							<Otherwise>
								<SetVariable variable="closing" select="." />
							</Otherwise>
						</Switch>
					</ForAll>
				</Case>
				<Otherwise>
					<SetVariable variable="opening">
						<Value select="ram:Content" />
					</SetVariable>
				</Otherwise>
			</Switch>
		</ForAll>

		<!-- Invoice number and date -->
		<Group name="invoice_info">
			<Contents>
				<PlaceObject>
					<Textblock width="180mm" fontfamily="invoice_info">
						<Paragraph textformat="right" html="off">
							<Value>Datum: </Value>
							<Value select="sf:format-date(ram:IssueDateTime/udt:DateTimeString)" />
							<Br />
							<Value>Rechnung </Value>
							<Value select="ram:ID" />
							<Switch>
								<Case test="not(string($PaymentTerms/ram:DueDateDateTime/udt:DateTimeString) = '')">
									<Br />
									<Value>Zahlungsziel: </Value>
									<Value select="sf:format-date($PaymentTerms/ram:DueDateDateTime/udt:DateTimeString)" />
								</Case>
							</Switch>
							<Switch>
								<Case test="sd:variable-exists('noteREG')">
									<Br />
									<Br />
									<Value select="$noteREG" />
								</Case>
							</Switch>
						</Paragraph>
					</Textblock>
				</PlaceObject>
			</Contents>
		</Group>
		<Switch>
			<Case test="$hasLetterhead">
				<PlaceObject column="{$region_invoice_info/bc:xCm + $region_invoice_info/bc:widthCm}cm" row="{$region_invoice_info/bc:yCm}cm" hreference="right" groupname="invoice_info" />
			</Case>
			<Otherwise>
				<PlaceObject column="200mm" row="45mm" hreference="right" groupname="invoice_info" />
			</Otherwise>
		</Switch>

	</Record>

	<Record element="ram:BuyerTradeParty">
		<!-- From and recipient-->
		<Switch>
			<Case test="not($hasLetterhead)">
				<PlaceObject column="20mm" row="45mm">
					<Textblock>
						<Paragraph fontfamily="small">
							<Value select="$SellerTradeParty/ram:Name" />
							<Value> · </Value>
							<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:LineOne" />
							<Value> · </Value>
							<Switch>
								<Case test="not(string($SellerTradeParty/ram:PostalTradeAddress/ram:LineTwo) = '')">
									<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:LineTwo" />
									<Value> · </Value>
								</Case>
							</Switch>
							<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:PostcodeCode" />
							<Value>&#xa0;</Value>
							<Value select="$SellerTradeParty/ram:PostalTradeAddress/ram:CityName" />
						</Paragraph>
					</Textblock>
				</PlaceObject>
			</Case>
		</Switch>
		<Group name="addressee">
			<Contents>
				<PlaceObject>
					<Textblock width="80mm">
						<Paragraph fontfamily="addressee">
							<Value select="ram:Name" />
							<Br />
							<Switch>
								<Case test="not(string(ram:DefinedTradeContact/ram:PersonName) = '')">
									<Value select="ram:DefinedTradeContact/ram:PersonName" />
									<Br />
								</Case>
							</Switch>
							<Value select="ram:PostalTradeAddress/ram:LineOne" />
							<Br />
							<Switch>
								<Case test="not(string(ram:PostalTradeAddress/ram:LineTwo) = '')">
									<Value select="ram:PostalTradeAddress/ram:LineTwo" />
									<Br />
								</Case>
							</Switch>
							<Switch>
								<Case test="not(string(ram:PostalTradeAddress/ram:LineThree) = '')">
									<Value select="sd:decode-html(ram:PostalTradeAddress/ram:LineThree)" />
									<Br />
								</Case>
							</Switch>

							<Value select="ram:PostalTradeAddress/ram:PostcodeCode" />
							<Value>&#xa0;</Value>
							<Value select="ram:PostalTradeAddress/ram:CityName" />
						</Paragraph>
					</Textblock>
				</PlaceObject>
			</Contents>
		</Group>
		<Switch>
			<Case test="$hasLetterhead">
				<PlaceObject column="{$region_addressee/bc:xCm}cm" row="{$region_addressee/bc:yCm}cm" groupname="addressee" />
			</Case>
			<Otherwise>
				<PlaceObject column="20mm" row="63mm" groupname="addressee" />
			</Otherwise>
		</Switch>
	</Record>
</Layout>
